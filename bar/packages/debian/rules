#!/usr/bin/make -f
# See debhelper(7) (uncomment to enable)
# output every command that modifies files on the build system.
export DH_VERBOSE = 1

# This is the debhelper compatibility version to use.
export DH_COMPAT=9

# see FEATURE AREAS in dpkg-buildflags(1)
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all

# see ENVIRONMENT in dpkg-buildflags(1)
# package maintainers to append CFLAGS
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
# package maintainers to append LDFLAGS
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

#ADDITIONAL_DOWNLOAD_FLAGS = zlib icu
ADDITIONAL_DOWNLOAD_FLAGS =
#ADDITIONAL_CONFIGURE_FLAGS = --disable-bz2 --disable-lzma --disable-xz --disable-lzo --disable-lz4 --disable-zstd --disable-xdelta3 --disable-gcrypt --disable-curl --disable-ssh --disable-tls --disable-iso9660 --disable-pcre
ADDITIONAL_CONFIGURE_FLAGS =

.PHONY: build
build:

.PHONY: build-indep
build-indep:

.PHONY: install
install:

.PHONY: clean
clean:
	dh_autoreconf_clean
	dh_clean

# ---------------------------------------------------------------------

build-stamp:
	#Note: debhelper >= 10
	#dh_update_autotools_config
	dh_autoreconf
	#Note: debhelper >= 10
	#dh_auto_configure
	./download-third-party-packages.sh \
          --no-verbose \
          $(ADDITIONAL_DOWNLOAD_FLAGS)
	./configure \
          --enable-extern-check \
          --disable-crashdump \
--disable-bfd \
--disable-epm \
          $(ADDITIONAL_CONFIGURE_FLAGS)
	#dh_auto_build
	make -C bar -j8 all
	make all
	#dh_auto_test
	touch $@

.PHONY: build-bar
build-bar: build-stamp
	echo --- bar -----------------------------------------------------------------

.PHONY: bar
bar: build-bar
	echo --- install-bar: build -----------------------------------------------------------------
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs -p$@
	# Add here commands to install the package
	# The DESTDIR Has To Be Exactly  /usr/src/packages/BUILD/debian/<nameOfPackage>
#	make \
#          DESTDIR=/usr/src/packages/BUILD/debian/bar DIST=1 SYSTEM=Debian SYSTEM_INIT=systemd \
#          install_bar
	make \
          DESTDIR=${PWD}/debian/bar DIST=1 SYSTEM=Debian SYSTEM_INIT=systemd \
          install_bar
	#           install_scripts install_man
	# --- end custom part for installing
	dh_installdocs -p$@
	dh_installchangelogs -p$@
	dh_installman -p$@
	dh_perl -p$@
	dh_link -p$@
	#Note: debhelper >= 10
	#dh_strip_nondeterminism -p$@
	dh_compress -p$@
	dh_fixperms -p$@
	#Note: debhelper >= 10
	#dh_missing -p$@
	dh_strip -p$@
	dh_makeshlibs -p$@
	dh_shlibdeps -p$@
	dh_installdeb -p$@
	dh_gencontrol -p$@
	dh_md5sums -p$@
	dh_builddeb -p$@

# ----------------------------------------------------------------------

.PHONY: build-bar-gui
build-bar-gui: build-stamp
	echo --- bar-gui -----------------------------------------------------------------

bar-gui: build-bar-gui
	echo --- install-bar-gui: build -----------------------------------------------------------------
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs -p$@
	# Add here commands to install the package
	# The DESTDIR Has To Be Exactly  /usr/src/packages/BUILD/debian/<nameOfPackage>
#	make \
#          DESTDIR=/usr/src/packages/BUILD/debian/bar-gui DIST=1 SYSTEM=Debian SYSTEM_INIT=systemd \
#          install_barcontrol
	make \
          DESTDIR=${PWD}/debian/bar-gui DIST=1 SYSTEM=Debian SYSTEM_INIT=systemd \
          install_barcontrol
	# --- end custom part for installing
	dh_installdocs -p$@
	dh_installchangelogs -p$@
	dh_installman -p$@
	dh_perl -p$@
	dh_link -p$@
	#Note: debhelper >= 10
	#dh_strip_nondeterminism -p$@
	dh_compress -p$@
	dh_fixperms -p$@
	#Note: debhelper >= 10
	#dh_missing -p$@
	dh_strip -p$@
	dh_makeshlibs -p$@
	dh_shlibdeps -p$@
	dh_installdeb -p$@
	dh_gencontrol -p$@
	dh_md5sums -p$@
	dh_builddeb -p$@

# ----------------------------------------------------------------------

.PHONY: binary
binary: bar bar-gui

.PHONY: binary-indep
binary-indep: bar-gui

%:
	echo XXX $@
	dh $@


# dh_make generated override targets
# This is example for Cmake (See https://bugs.debian.org/641051 )
#override_dh_auto_configure:
#	dh_auto_configure -- #	-DCMAKE_LIBRARY_PATH=$(DEB_HOST_MULTIARCH)
