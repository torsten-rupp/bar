#!/usr/bin/make -f

# See debhelper(7) (uncomment to enable)
# output every command that modifies files on the build system.
export DH_VERBOSE = 1

# This is the debhelper compatibility version to use.
export DH_COMPAT=9

# see FEATURE AREAS in dpkg-buildflags(1)
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all

# see ENVIRONMENT in dpkg-buildflags(1)
# package maintainers to append CFLAGS
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
# package maintainers to append LDFLAGS
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

#ADDITIONAL_DOWNLOAD_FLAGS = zlib icu
ADDITIONAL_DOWNLOAD_FLAGS =
#ADDITIONAL_CONFIGURE_FLAGS = --disable-bz2 --disable-lzma --disable-xz --disable-lzo --disable-lz4 --disable-zstd --disable-xdelta3 --disable-gcrypt --disable-curl --disable-ssh --disable-tls --disable-iso9660 --disable-pcre
ADDITIONAL_CONFIGURE_FLAGS =

.PHONY: build
build:

.PHONY: build-indep
build-indep:

.PHONY: install
install:

.PHONY: clean
clean:
	dh_autoreconf_clean
	dh_clean

# ---------------------------------------------------------------------

build-stamp:
	@echo --- bar -----------------------------------------------------------------
	pwd
	echo packageName=$(packageName)
	#Note: debhelper >= 10
	#dh_update_autotools_config
	dh_autoreconf
	#Note: debhelper >= 10
	#dh_auto_configure
	./download-third-party-packages.sh \
          --clean
	./download-third-party-packages.sh \
          --no-verbose \
          $(ADDITIONAL_DOWNLOAD_FLAGS)
	./configure \
          --enable-extern-check \
          --disable-crashdump \
          --disable-epm \
          $(ADDITIONAL_CONFIGURE_FLAGS)
	#dh_auto_build
	make -C bar -j8 all
	make all
	#dh_auto_test
	touch $@

.PHONY: build-bar
build-bar: build-stamp

$(packageName): build-bar
	@echo --- install-bar: build -----------------------------------------------------------------
	pwd
	echo packageName=$(packageName)
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs -p$(packageName)
	# Add here commands to install the package
	# The DESTDIR Has To Be Exactly  /usr/src/packages/BUILD/debian/<nameOfPackage>
	make \
          DESTDIR=${PWD}/debian/$(packageName) DIST=1 SYSTEM_INIT=systemd \
          install_bar install_scripts
	#           install_scripts install_man
	# --- end custom part for installing
	dh_installdocs -p$(packageName)
	dh_installchangelogs -p$(packageName)
	dh_installman -p$(packageName)
	dh_perl -p$(packageName)
	dh_link -p$(packageName)
	#Note: debhelper >= 10
	#dh_strip_nondeterminism -p$(packageName)
	dh_compress -p$(packageName)
	dh_fixperms -p$(packageName)
	#Note: debhelper >= 10
	#dh_missing -p$(packageName)
	dh_strip -p$(packageName)
	dh_makeshlibs -p$(packageName)
	dh_shlibdeps -p$(packageName)
	dh_installdeb -p$(packageName)
	dh_gencontrol -p$(packageName)
	dh_md5sums -p$(packageName)
	dh_builddeb -p$(packageName)

# ----------------------------------------------------------------------

.PHONY: build-bar-gui
build-bar-gui: build-stamp

$(packageName)-gui: build-bar-gui
	@echo --- install-bar-gui: build -----------------------------------------------------------------
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs -p$(packageName)-gui
	# Add here commands to install the package
	# The DESTDIR Has To Be Exactly  /usr/src/packages/BUILD/debian/<nameOfPackage>
	make \
          DESTDIR=${PWD}/debian/$(packageName)-gui DIST=1 SYSTEM_INIT=systemd \
          install_barcontrol
	# --- end custom part for installing
	dh_installdocs -p$(packageName)-gui
	dh_installchangelogs -p$(packageName)-gui
	dh_installman -p$(packageName)-gui
	dh_perl -p$(packageName)-gui
	dh_link -p$(packageName)-gui
	#Note: debhelper >= 10
	#dh_strip_nondeterminism -p$(packageName)-gui
	dh_compress -p$(packageName)-gui
	dh_fixperms -p$(packageName)-gui
	#Note: debhelper >= 10
	#dh_missing -p$(packageName)-gui
	dh_strip -p$(packageName)-gui
	dh_makeshlibs -p$(packageName)-gui
	dh_shlibdeps -p$(packageName)-gui
	dh_installdeb -p$(packageName)-gui
	dh_gencontrol -p$(packageName)-gui
	dh_md5sums -p$(packageName)-gui
	dh_builddeb -p$(packageName)-gui

# ----------------------------------------------------------------------

.PHONY: binary
binary: $(packageName) $(packageName)-gui

.PHONY: binary-indep
binary-indep: $(packageName)-gui

%:
	dh $@

# dh_make generated override targets
# This is example for Cmake (See https://bugs.debian.org/641051 )
#override_dh_auto_configure:
#	dh_auto_configure -- #	-DCMAKE_LIBRARY_PATH=$(DEB_HOST_MULTIARCH)
